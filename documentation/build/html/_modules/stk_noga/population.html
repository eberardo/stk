

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>stk_noga.population &mdash; mtk  documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="mtk  documentation" href="../../index.html"/>
        <link rel="up" title="Module code" href="../index.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> mtk
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <!-- Local TOC -->
              <div class="local-toc"></div>
            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">mtk</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>stk_noga.population</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for stk_noga.population</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Defines :class:`Population`.</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">itertools</span> <span class="k">as</span> <span class="nn">it</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="k">import</span> <span class="n">join</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">glob</span> <span class="k">import</span> <span class="n">iglob</span>
<span class="kn">import</span> <span class="nn">multiprocessing</span> <span class="k">as</span> <span class="nn">mp</span>
<span class="kn">import</span> <span class="nn">psutil</span>

<span class="kn">from</span> <span class="nn">.molecular</span> <span class="k">import</span> <span class="n">Molecule</span>
<span class="kn">from</span> <span class="nn">.convenience_tools</span> <span class="k">import</span> <span class="n">dedupe</span>
<span class="kn">from</span> <span class="nn">.optimization.optimization</span> <span class="k">import</span> <span class="p">(</span><span class="n">_optimize_all_serial</span><span class="p">,</span>
                                        <span class="n">_optimize_all</span><span class="p">)</span>


<div class="viewcode-block" id="Population"><a class="viewcode-back" href="../../stk_noga.population.html#stk_noga.population.Population">[docs]</a><span class="k">class</span> <span class="nc">Population</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A container for  :class:`.Molecule` objects.</span>

<span class="sd">    :class:`Population` instances can be nested.</span>

<span class="sd">    In addtion to holding :class:`.Molecule` objects, the</span>
<span class="sd">    :class:`Population` class can be used to create large numbers of</span>
<span class="sd">    these instances through the :meth:`init\_` class methods.</span>

<span class="sd">    :class:`.Molecule` instances held by a :class:`Population` can have</span>
<span class="sd">    their structures optimized in parallel through the</span>
<span class="sd">    :meth:`optimize` method.</span>

<span class="sd">    The only operations directly implemented by this class are those</span>
<span class="sd">    relevant to its role as a container. It supports all expected and</span>
<span class="sd">    necessary container operations such as iteration, indexing,</span>
<span class="sd">    membership checks (via the ``is in`` operator) as would be</span>
<span class="sd">    expected. Details of the various implementations and a full list of</span>
<span class="sd">    supported operations can be found by examining the included</span>
<span class="sd">    methods.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    populations : :class:`list` of :class:`Population` instances</span>
<span class="sd">        A list of other instances of the :class:`Population` class.</span>
<span class="sd">        This allows the implementation of subpopulations or</span>
<span class="sd">        evolutionary islands. This attribute is also used for grouping</span>
<span class="sd">        molecules within a given population for organizational</span>
<span class="sd">        purposes.</span>

<span class="sd">    members : :class:`list` of :class:`.Molecule` instances</span>
<span class="sd">        Held here are the members of the population which are not held</span>
<span class="sd">        within any subpopulations. This means that not all members of a</span>
<span class="sd">        population are stored in this attribute. To access all members</span>
<span class="sd">        of a population the generator :meth:`all_members` should be</span>
<span class="sd">        used.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Intializes a population.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        *args : :class:`.Molecule`, :class:`Population`</span>
<span class="sd">            A population is initialized with the :class:`.Molecule` and</span>
<span class="sd">            :class:`Population` instances it should hold. These are</span>
<span class="sd">            placed into the :attr:`members` or :attr:`populations`</span>
<span class="sd">            attributes, respectively.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">populations</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">members</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">Population</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">populations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">Molecule</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">members</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">((</span><span class="s1">&#39;Must use Population and Molecule &#39;</span>
                                 <span class="s1">&#39;objects for initialization.&#39;</span><span class="p">))</span>

<div class="viewcode-block" id="Population.init_all"><a class="viewcode-back" href="../../stk_noga.population.html#stk_noga.population.Population.init_all">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">init_all</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span>
                 <span class="n">macromol_class</span><span class="p">,</span>
                 <span class="n">building_blocks</span><span class="p">,</span>
                 <span class="n">topologies</span><span class="p">,</span>
                 <span class="n">processes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">duplicates</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates all possible molecules from provided building blocks.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        macromol_class : :class:`type`</span>
<span class="sd">            The class of the :class:`.MacroMolecule` objects being</span>
<span class="sd">            built.</span>

<span class="sd">        building_blocks : :class:`list`</span>
<span class="sd">            A :class:`list` of the form</span>

<span class="sd">            .. code-block:: python</span>

<span class="sd">                building_blocks = [[StructUnit2(), StructUnit2(), ...],</span>
<span class="sd">                                   [StructUnit3(), StructUnit3(), ...],</span>
<span class="sd">                                   [StructUnit2(), StructUnit2(), ...]]</span>

<span class="sd">            To assemble a new :class:`.MacroMolecule`, a</span>
<span class="sd">            :class:`.StructUnit` is picked from each of the sublists</span>
<span class="sd">            in `building_blocks`. The picked :class:`.StructUnit`</span>
<span class="sd">            instances are then supplied to the macromolecule:</span>

<span class="sd">            .. code-block:: python</span>

<span class="sd">                macro_mol = MacroMolecule([pick1, pick2, pick3],</span>
<span class="sd">                                          Topology())</span>

<span class="sd">            The order of picked :class:`.StructUnit` instances</span>
<span class="sd">            corresponds to the order of the sublists.</span>

<span class="sd">        topologies : :class:`list` of :class:`.Topology`</span>
<span class="sd">            The topologies of macromolecules being made.</span>

<span class="sd">        processes : :class:`int`, optional</span>
<span class="sd">            The number of parallel processes to create when building</span>
<span class="sd">            the molecules.</span>

<span class="sd">        duplicates : :class:`bool`, optional</span>
<span class="sd">            If ``False``, duplicate structures are removed from</span>
<span class="sd">            the population.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        :class:`Population`</span>
<span class="sd">            A population holding all possible macromolecules from</span>
<span class="sd">            assembled from `databases`.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">args</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="o">*</span><span class="n">bbs</span><span class="p">,</span> <span class="n">topology</span> <span class="ow">in</span> <span class="n">it</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">building_blocks</span><span class="p">,</span> <span class="n">topologies</span><span class="p">):</span>
            <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">bbs</span><span class="p">,</span> <span class="n">topology</span><span class="p">))</span>

        <span class="k">with</span> <span class="n">mp</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span><span class="n">processes</span><span class="p">)</span> <span class="k">as</span> <span class="n">pool</span><span class="p">:</span>
            <span class="n">mols</span> <span class="o">=</span> <span class="n">pool</span><span class="o">.</span><span class="n">starmap</span><span class="p">(</span><span class="n">macromol_class</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>

        <span class="c1"># Update the cache.</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">mol</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mols</span><span class="p">):</span>
            <span class="c1"># If the molecule did not exist already add it to the</span>
            <span class="c1"># cache.</span>
            <span class="k">if</span> <span class="n">mol</span><span class="o">.</span><span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">macromol_class</span><span class="o">.</span><span class="n">cache</span><span class="p">:</span>
                <span class="n">macromol_class</span><span class="o">.</span><span class="n">cache</span><span class="p">[</span><span class="n">mol</span><span class="o">.</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">mol</span>
            <span class="c1"># If the molecule did exist already, use the cached</span>
            <span class="c1"># version.</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">mols</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">macromol_class</span><span class="o">.</span><span class="n">cache</span><span class="p">[</span><span class="n">mol</span><span class="o">.</span><span class="n">key</span><span class="p">]</span>

        <span class="n">p</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="o">*</span><span class="n">mols</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">duplicates</span><span class="p">:</span>
            <span class="n">p</span><span class="o">.</span><span class="n">remove_duplicates</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">p</span></div>

<div class="viewcode-block" id="Population.init_diverse"><a class="viewcode-back" href="../../stk_noga.population.html#stk_noga.population.Population.init_diverse">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">init_diverse</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span>
                     <span class="n">macromol_class</span><span class="p">,</span>
                     <span class="n">building_blocks</span><span class="p">,</span>
                     <span class="n">topologies</span><span class="p">,</span>
                     <span class="n">size</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Assembles a population of :class:`.MacroMolecule`.</span>

<span class="sd">        All molecules are held in the :attr:`members`.</span>

<span class="sd">        From the supplied sublists of building blocks, a random</span>
<span class="sd">        molecule is selected to initialize a :class:`.MacroMolecule`</span>
<span class="sd">        per sublist. The next molecule selected from the same sublist</span>
<span class="sd">        is the one most with the most different Morgan fingerprint. The</span>
<span class="sd">        next molecule is picked at random again and so on. This is done</span>
<span class="sd">        until `size` :class:`.MacroMolecule` instances have been</span>
<span class="sd">        formed.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        macromol_class : :class:`type`</span>
<span class="sd">            The class of :class:`.MacroMolecule` to be assembled.</span>

<span class="sd">        building_blocks : :class:`list`</span>
<span class="sd">            A :class:`list` of the form</span>

<span class="sd">            .. code-block:: python</span>

<span class="sd">                building_blocks = [[StructUnit2(), StructUnit2(), ...],</span>
<span class="sd">                                   [StructUnit3(), StructUnit3(), ...],</span>
<span class="sd">                                   [StructUnit2(), StructUnit2(), ...]]</span>

<span class="sd">            To assemble a new :class:`.MacroMolecule`, a</span>
<span class="sd">            :class:`.StructUnit` is picked from each of the sublists</span>
<span class="sd">            in `building_blocks`. The picked :class:`.StructUnit`</span>
<span class="sd">            instances are then supplied to the macromolecule:</span>

<span class="sd">            .. code-block:: python</span>

<span class="sd">                macro_mol = MacroMolecule([pick1, pick2, pick3],</span>
<span class="sd">                                          Topology())</span>

<span class="sd">            The order of picked :class:`.StructUnit` instances</span>
<span class="sd">            corresponds to the order of the sublists.</span>

<span class="sd">        topolgies : :class:`iterable` of :class:`.Topology`</span>
<span class="sd">            An iterable holding topologies which should be randomly</span>
<span class="sd">            selected during initialization of :class:`.MacroMolecule`.</span>

<span class="sd">        size : :class:`int`</span>
<span class="sd">            The size of the population to be initialized.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        :class:`.Population`</span>
<span class="sd">            A population filled with generated molecules.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">pop</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>

        <span class="c1"># Shuffle the sublists.</span>
        <span class="k">for</span> <span class="n">db</span> <span class="ow">in</span> <span class="n">building_blocks</span><span class="p">:</span>
            <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>

        <span class="c1"># Go through every possible macromolecule.</span>
        <span class="k">for</span> <span class="o">*</span><span class="n">bbs</span><span class="p">,</span> <span class="n">top</span> <span class="ow">in</span> <span class="n">it</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">building_blocks</span><span class="p">,</span> <span class="n">topologies</span><span class="p">):</span>

            <span class="c1"># Generate the random macromolecule.</span>
            <span class="n">macro_mol</span> <span class="o">=</span> <span class="n">macromol_class</span><span class="p">(</span><span class="n">bbs</span><span class="p">,</span> <span class="n">top</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">macro_mol</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">pop</span><span class="p">:</span>
                <span class="n">pop</span><span class="o">.</span><span class="n">members</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">macro_mol</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pop</span><span class="p">)</span> <span class="o">==</span> <span class="n">size</span><span class="p">:</span>
                <span class="k">break</span>

            <span class="c1"># Make an iterators which goes through all rdkit molecules</span>
            <span class="c1"># in the sublists.</span>
            <span class="n">mol_iters</span> <span class="o">=</span> <span class="p">[(</span><span class="n">struct_unit</span><span class="o">.</span><span class="n">mol</span> <span class="k">for</span> <span class="n">struct_unit</span> <span class="ow">in</span> <span class="n">db</span><span class="p">)</span> <span class="k">for</span>
                         <span class="n">db</span> <span class="ow">in</span> <span class="n">building_blocks</span><span class="p">]</span>
            <span class="c1"># Make a dictionary which maps every rdkit molecule to its</span>
            <span class="c1"># StructUnit, for every sublist in building_blocks.</span>
            <span class="n">mol_maps</span> <span class="o">=</span> <span class="p">[{</span><span class="n">struct_unit</span><span class="o">.</span><span class="n">mol</span><span class="p">:</span> <span class="n">struct_unit</span> <span class="k">for</span> <span class="n">struct_unit</span> <span class="ow">in</span> <span class="n">db</span><span class="p">}</span>
                        <span class="k">for</span> <span class="n">db</span> <span class="ow">in</span> <span class="n">building_blocks</span><span class="p">]</span>

            <span class="c1"># Get the most different StructUnit to the previously</span>
            <span class="c1"># selected one, per sublist. Take index of 1 because the</span>
            <span class="c1"># index of 0 will the molecule itself.</span>
            <span class="n">diff_mols</span> <span class="o">=</span> <span class="p">[</span><span class="n">bb</span><span class="o">.</span><span class="n">similar_molecules</span><span class="p">(</span><span class="n">mols</span><span class="p">)[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span>
                         <span class="n">bb</span><span class="p">,</span> <span class="n">mols</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">bbs</span><span class="p">,</span> <span class="n">mol_iters</span><span class="p">)]</span>
            <span class="n">diff_bbs</span> <span class="o">=</span> <span class="p">[</span><span class="n">mol_map</span><span class="p">[</span><span class="n">mol</span><span class="p">]</span> <span class="k">for</span>
                        <span class="n">mol_map</span><span class="p">,</span> <span class="n">mol</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">mol_maps</span><span class="p">,</span> <span class="n">diff_mols</span><span class="p">)]</span>

            <span class="n">macro_mol</span> <span class="o">=</span> <span class="n">macromol_class</span><span class="p">(</span><span class="n">diff_bbs</span><span class="p">,</span> <span class="n">top</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">macro_mol</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">pop</span><span class="p">:</span>
                <span class="n">pop</span><span class="o">.</span><span class="n">members</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">macro_mol</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pop</span><span class="p">)</span> <span class="o">==</span> <span class="n">size</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">pop</span><span class="p">)</span> <span class="o">==</span> <span class="n">size</span>
        <span class="k">return</span> <span class="n">pop</span></div>

<div class="viewcode-block" id="Population.init_from_files"><a class="viewcode-back" href="../../stk_noga.population.html#stk_noga.population.Population.init_from_files">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">init_from_files</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">folder</span><span class="p">,</span> <span class="n">moltype</span><span class="p">,</span> <span class="n">glob_pattern</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a population from files in `folder`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        folder : :class:`str`</span>
<span class="sd">            The path to a folder holding molecular structure files</span>
<span class="sd">            used to initialize :class:`~.Molecule` objects held by</span>
<span class="sd">            the population.</span>

<span class="sd">        moltype : :class:`type`</span>
<span class="sd">            An initializer for the molecular structure files. For</span>
<span class="sd">            example, :class:`.StructUnit` or :class:`.StructUnit2`.</span>
<span class="sd">            If `folder` contains ``.json`` dump files of</span>
<span class="sd">            :class:`.MacroMolecule` then :meth:`.Molecule.load` could</span>
<span class="sd">            also be used.</span>

<span class="sd">        glob_pattern : :class:`str`, optional</span>
<span class="sd">            A glob used for selecting specific files within `folder`.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        :class:`Population`</span>
<span class="sd">            A population made from files in `folder`.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">moltype</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span>
                     <span class="n">iglob</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">glob_pattern</span><span class="p">))))</span></div>

<div class="viewcode-block" id="Population.init_random"><a class="viewcode-back" href="../../stk_noga.population.html#stk_noga.population.Population.init_random">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">init_random</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span>
                    <span class="n">macromol_class</span><span class="p">,</span>
                    <span class="n">building_blocks</span><span class="p">,</span>
                    <span class="n">topologies</span><span class="p">,</span>
                    <span class="n">size</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Assembles a population of :class:`.MacroMolecule`.</span>

<span class="sd">        All molecules are held in :attr:`members`.</span>

<span class="sd">        From the supplied building blocks a random molecule is selected</span>
<span class="sd">        per sublist to for a :class:`.MacroMolecule`. This is done</span>
<span class="sd">        until `size` :class:`.MacroMolecule` have been formed.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        macromol_class : :class:`type`</span>
<span class="sd">            The class of :class:`.MacroMolecule` to be assembled.</span>

<span class="sd">        building_blocks : :class:`list`</span>
<span class="sd">            A :class:`list` of the form</span>

<span class="sd">            .. code-block:: python</span>

<span class="sd">                building_blocks = [[StructUnit2(), StructUnit2(), ...],</span>
<span class="sd">                                   [StructUnit3(), StructUnit3(), ...],</span>
<span class="sd">                                   [StructUnit2(), StructUnit2(), ...]]</span>

<span class="sd">            To assemble a new :class:`.MacroMolecule`, a</span>
<span class="sd">            :class:`.StructUnit` is picked from each of the sublists</span>
<span class="sd">            in `building_blocks`. The picked :class:`.StructUnit`</span>
<span class="sd">            instances are then supplied to the macromolecule:</span>

<span class="sd">            .. code-block:: python</span>

<span class="sd">                macro_mol = MacroMolecule([pick1, pick2, pick3],</span>
<span class="sd">                                          Topology())</span>

<span class="sd">            The order of picked :class:`.StructUnit` instances</span>
<span class="sd">            corresponds to the order of the sublists.</span>

<span class="sd">        topolgies : :class:`iterable` of :class:`.Topology`</span>
<span class="sd">            An iterable holding topologies which should be randomly</span>
<span class="sd">            selected during initialization of :class:`.MacroMolecule`.</span>

<span class="sd">        size : :class:`int`</span>
<span class="sd">            The size of the population to be initialized.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        :class:`.Population`</span>
<span class="sd">            A population filled with random cages.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">pop</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>

        <span class="c1"># Shuffle the sublists.</span>
        <span class="k">for</span> <span class="n">db</span> <span class="ow">in</span> <span class="n">building_blocks</span><span class="p">:</span>
            <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>

        <span class="c1"># Go through every possible macromolecule.</span>
        <span class="k">for</span> <span class="o">*</span><span class="n">bbs</span><span class="p">,</span> <span class="n">top</span> <span class="ow">in</span> <span class="n">it</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">building_blocks</span><span class="p">,</span> <span class="n">topologies</span><span class="p">):</span>

            <span class="c1"># Generate the random macromolecule.</span>
            <span class="n">macro_mol</span> <span class="o">=</span> <span class="n">macromol_class</span><span class="p">(</span><span class="n">bbs</span><span class="p">,</span> <span class="n">top</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">macro_mol</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">pop</span><span class="p">:</span>
                <span class="n">pop</span><span class="o">.</span><span class="n">members</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">macro_mol</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pop</span><span class="p">)</span> <span class="o">==</span> <span class="n">size</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">pop</span><span class="p">)</span> <span class="o">==</span> <span class="n">size</span>
        <span class="k">return</span> <span class="n">pop</span></div>

<div class="viewcode-block" id="Population.add_members"><a class="viewcode-back" href="../../stk_noga.population.html#stk_noga.population.Population.add_members">[docs]</a>    <span class="k">def</span> <span class="nf">add_members</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">population</span><span class="p">,</span> <span class="n">duplicates</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds :class:`.Molecule` instances into :attr:`members`.</span>

<span class="sd">        The :class:`.Molecule`  instances held within `population`, are</span>
<span class="sd">        added into :attr:`members`. Any nesting is removed. This is</span>
<span class="sd">        because all :class:`.Molecule`  instances are added into</span>
<span class="sd">        :attr:`members` directly, regardless of how nested they are</span>
<span class="sd">        within `population`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        population : :class:`iterable` of :class:`.Molecule`</span>
<span class="sd">            :class:`.Molecule` instances held by this container are</span>
<span class="sd">            added into :attr:`members`.</span>

<span class="sd">        duplicates : :class:`bool`, optional</span>
<span class="sd">            Indicates whether multiple instances of the same molecule</span>
<span class="sd">            are allowed to be added. Note, the sameness of a molecule</span>
<span class="sd">            is judged by :meth:`.Molecule.same`.</span>

<span class="sd">            When ``False`` only molecules which are not already</span>
<span class="sd">            held by the population will be added. ``True`` allows more</span>
<span class="sd">            than one instance of the same molecule to be added.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None : :class:`NoneType`</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">duplicates</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">members</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">mol</span> <span class="k">for</span> <span class="n">mol</span> <span class="ow">in</span> <span class="n">population</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">members</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">mol</span> <span class="k">for</span> <span class="n">mol</span> <span class="ow">in</span> <span class="n">population</span> <span class="k">if</span>
                                <span class="n">mol</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="Population.add_subpopulation"><a class="viewcode-back" href="../../stk_noga.population.html#stk_noga.population.Population.add_subpopulation">[docs]</a>    <span class="k">def</span> <span class="nf">add_subpopulation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">population</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Appends a copy of `population` to :attr:`populations`.</span>

<span class="sd">        Only a copy of the `population` container is made. The</span>
<span class="sd">        molecules it holds are not copies.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        population : :class:`Population`</span>
<span class="sd">            The population to be added as a subpopulation.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None : :class:`NoneType`</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">pop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="o">*</span><span class="n">population</span><span class="o">.</span><span class="n">members</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">sp</span> <span class="ow">in</span> <span class="n">population</span><span class="o">.</span><span class="n">populations</span><span class="p">:</span>
            <span class="n">pop</span><span class="o">.</span><span class="n">add_subpopulation</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">populations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pop</span><span class="p">)</span></div>

<div class="viewcode-block" id="Population.all_members"><a class="viewcode-back" href="../../stk_noga.population.html#stk_noga.population.Population.all_members">[docs]</a>    <span class="k">def</span> <span class="nf">all_members</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Yields all molecules in the population and its subpopulations.</span>

<span class="sd">        Yields</span>
<span class="sd">        ------</span>
<span class="sd">        :class:`.Molecule`</span>
<span class="sd">            The next :class:`.Molecule` instance held within the</span>
<span class="sd">            population or its subpopulations.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Go through `members` attribute and yield ``Molecule``</span>
        <span class="c1"># instances held within one by one.</span>
        <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">members</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">ind</span>

        <span class="c1"># Go thorugh `populations` attribute and for each</span>
        <span class="c1"># ``Population`` instance within, yield ``Molecule``</span>
        <span class="c1"># instances from its `all_members` generator.</span>
        <span class="k">for</span> <span class="n">pop</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">populations</span><span class="p">:</span>
            <span class="k">yield from</span> <span class="n">pop</span><span class="o">.</span><span class="n">all_members</span><span class="p">()</span></div>

<div class="viewcode-block" id="Population.assign_names_from"><a class="viewcode-back" href="../../stk_noga.population.html#stk_noga.population.Population.assign_names_from">[docs]</a>    <span class="k">def</span> <span class="nf">assign_names_from</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Give each member of the population a name starting from `n`.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This method modifies the :attr:`.Molecule.name` attribute of</span>
<span class="sd">        :class:`.Molecule` instances held by the population.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        n : :class:`int`</span>
<span class="sd">            A number. Members of this population are given a unique</span>
<span class="sd">            number as a name, starting from this number and incremented</span>
<span class="sd">            by one between members.</span>

<span class="sd">        overwrite : :class:`bool`, optional</span>
<span class="sd">            If ``True``, existing names are replaced.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        :class:`int`</span>
<span class="sd">            The value of the last name assigned, plus 1.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">mem</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">mem</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span> <span class="n">overwrite</span><span class="p">:</span>
                <span class="n">mem</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
                <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="n">n</span></div>

<div class="viewcode-block" id="Population.dump"><a class="viewcode-back" href="../../stk_noga.population.html#stk_noga.population.Population.dump">[docs]</a>    <span class="k">def</span> <span class="nf">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dumps the population to a file.</span>

<span class="sd">        The population is dumped in the JSON format in the following</span>
<span class="sd">        way. The population is represented as a list,</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            [mem1.json(), mem2.json(), [mem3.json(), [mem4.json()]]]</span>

<span class="sd">        where each member of the population held directly in the</span>
<span class="sd">        `members` attribute is placed an an element in the list. Any</span>
<span class="sd">        subpopulations are held as sublists.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path : :class:`str`</span>
<span class="sd">            The full path of the file to which the population should</span>
<span class="sd">            be dumped.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None : :class:`NoneType`</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">to_list</span><span class="p">(),</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span></div>

<div class="viewcode-block" id="Population.from_list"><a class="viewcode-back" href="../../stk_noga.population.html#stk_noga.population.Population.from_list">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_list</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">pop_list</span><span class="p">,</span> <span class="n">member_init</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes a population from a :class:`list` representation.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        pop_list : :class:`list`</span>
<span class="sd">            A :class:`list` which represents a population. Like the</span>
<span class="sd">            ones created by :meth:`to_list`. For example in,</span>

<span class="sd">            .. code-block:: python</span>

<span class="sd">                pop_list = [{...}, [{...}], [{...}, {...}], {...}]</span>

<span class="sd">            ``pop_list`` represents the population, sublists represent</span>
<span class="sd">            its subpopulations and the :class:`dict` ``{...}``</span>
<span class="sd">            represents the members.</span>

<span class="sd">        member_init : :class:`function`</span>
<span class="sd">            The initialization function for the population&#39;s members.</span>
<span class="sd">            It converts the member represenations in `pop_list` into</span>
<span class="sd">            desired objects.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        :class:`Population`</span>
<span class="sd">            The population represented by `pop_list`.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">pop</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">pop_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">pop</span><span class="o">.</span><span class="n">members</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">member_init</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">pop</span><span class="o">.</span><span class="n">populations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">member_init</span><span class="p">))</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">((</span><span class="s1">&#39;Population list must consist only&#39;</span>
                                 <span class="s1">&#39; of strings and lists.&#39;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">pop</span></div>

<div class="viewcode-block" id="Population.has_structure"><a class="viewcode-back" href="../../stk_noga.population.html#stk_noga.population.Population.has_structure">[docs]</a>    <span class="k">def</span> <span class="nf">has_structure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mol</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns ``True`` if molecule with `mol` structure is held.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        mol : :class:`.Molecule`</span>
<span class="sd">            A molecule whose structure is being evaluated for presence</span>
<span class="sd">            in the population.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        :class:`bool`</span>
<span class="sd">            ``True`` if a molecule with the same structure as `mol`</span>
<span class="sd">            is held by the population.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">same</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="Population.load"><a class="viewcode-back" href="../../stk_noga.population.html#stk_noga.population.Population.load">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">member_init</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes a :class:`Population` from one dumped to a file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path : :class:`str`</span>
<span class="sd">            The full path of the file holding the dumped population.</span>

<span class="sd">        member_init : :class:`function`</span>
<span class="sd">            The initialization function for the population&#39;s members.</span>
<span class="sd">            It converts the member representations in the file to</span>
<span class="sd">            :class:`.Molecule` objects. For example</span>
<span class="sd">            :meth:`.Molecule.from_dict` when loading ``.json`` files</span>
<span class="sd">            generated by :meth:`dump`.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        :class:`Population`</span>
<span class="sd">            The population stored in the dump file.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">pop_list</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="n">pop_list</span><span class="p">,</span> <span class="n">member_init</span><span class="p">)</span></div>

<div class="viewcode-block" id="Population.max"><a class="viewcode-back" href="../../stk_noga.population.html#stk_noga.population.Population.max">[docs]</a>    <span class="k">def</span> <span class="nf">max</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates the maximum in the population given a key.</span>

<span class="sd">        This method applies ``key(member)`` on every member of the</span>
<span class="sd">        population and returns the maximum of returned values.</span>

<span class="sd">        For example, if the maximum molecular cavity in the</span>
<span class="sd">        population is desired:</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            population.max(lambda macro_mol: macro_mol.cavity_size())</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        key : :class:`function`</span>
<span class="sd">            A function which should take a :class:`.Molecule` instance</span>
<span class="sd">            as its argument and returns a numerical value.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        :class:`float`</span>
<span class="sd">            The maximum of the values returned by the function `key`</span>
<span class="sd">            when it is applied to all members of the population.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">key</span><span class="p">(</span><span class="n">member</span><span class="p">)</span> <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></div>

<div class="viewcode-block" id="Population.mean"><a class="viewcode-back" href="../../stk_noga.population.html#stk_noga.population.Population.mean">[docs]</a>    <span class="k">def</span> <span class="nf">mean</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates the mean in the population given a key.</span>

<span class="sd">        This method applies ``key(member)`` on every member of the</span>
<span class="sd">        population and returns the mean of returned values.</span>

<span class="sd">        For example, if the mean of molecular cavities in the</span>
<span class="sd">        population is desired:</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            population.mean(lambda macro_mol: macro_mol.cavity_size())</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        key : :class:`function`</span>
<span class="sd">            A function which should take a :class:`.Molecule` instance</span>
<span class="sd">            as its argument and returns a numerical value.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        :class:`float`</span>
<span class="sd">            The mean of the values returned by the function `key` when</span>
<span class="sd">            it is applied to all members of the population.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="n">key</span><span class="p">(</span><span class="n">member</span><span class="p">)</span> <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></div>

<div class="viewcode-block" id="Population.min"><a class="viewcode-back" href="../../stk_noga.population.html#stk_noga.population.Population.min">[docs]</a>    <span class="k">def</span> <span class="nf">min</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates the minimum in the population given a key.</span>

<span class="sd">        This method applies ``key(member)`` on every member of the</span>
<span class="sd">        population and returns the minimum of returned values.</span>

<span class="sd">        For example, if the minimum molecular cavity in the</span>
<span class="sd">        population is desired:</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            population.min(lambda macro_mol: macro_mol.cavity_size())</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        key : :class:`function`</span>
<span class="sd">            A function which should take a :class:`.Molecule` instance</span>
<span class="sd">            as its argument and returns a numerical value.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        :class:`float`</span>
<span class="sd">            The minimum of the values returned by the function `key`</span>
<span class="sd">            when it is applied to all members of the population.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="n">key</span><span class="p">(</span><span class="n">member</span><span class="p">)</span> <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></div>

<div class="viewcode-block" id="Population.optimize"><a class="viewcode-back" href="../../stk_noga.population.html#stk_noga.population.Population.optimize">[docs]</a>    <span class="k">def</span> <span class="nf">optimize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func_data</span><span class="p">,</span> <span class="n">processes</span><span class="o">=</span><span class="n">psutil</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Optimizes the structures of molecules in the population.</span>

<span class="sd">        The molecules are optimized serially or in parallel depending</span>
<span class="sd">        if `processes` is ``1`` or more. The serial version may be</span>
<span class="sd">        faster in cases where all molecules have already been</span>
<span class="sd">        optimized. This is because all optimizations will be skipped.</span>
<span class="sd">        In this case creating a parallel process pool creates</span>
<span class="sd">        unncessary overhead.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This function modifies the structures of molecules held by the</span>
<span class="sd">        population. This means their :attr:`.Molecule.mol` attributes</span>
<span class="sd">        are modified.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        func_data : :class:`.FunctionData`</span>
<span class="sd">            Holds the name and arguments of an optimization function</span>
<span class="sd">            defined in :mod:`~stk.optimization`. The function is used</span>
<span class="sd">            to optimize the molecules in the population.</span>

<span class="sd">        processes : :class:`int`</span>
<span class="sd">            The number of parallel processes to create. Optimization</span>
<span class="sd">            will run serially if ``1``.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None : :class:`NoneType`</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">processes</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">_optimize_all_serial</span><span class="p">(</span><span class="n">func_data</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_optimize_all</span><span class="p">(</span><span class="n">func_data</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">processes</span><span class="p">)</span></div>

<div class="viewcode-block" id="Population.remove_duplicates"><a class="viewcode-back" href="../../stk_noga.population.html#stk_noga.population.Population.remove_duplicates">[docs]</a>    <span class="k">def</span> <span class="nf">remove_duplicates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                          <span class="n">between_subpops</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                          <span class="n">key</span><span class="o">=</span><span class="nb">id</span><span class="p">,</span>
                          <span class="n">top_seen</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes duplicates from the population and preserves structure.</span>

<span class="sd">        The question of which molcule is preserved when duplicates are</span>
<span class="sd">        removed is difficult to answer. The iteration through a</span>
<span class="sd">        population is depth-first, so a rule such as &quot;the molecule in</span>
<span class="sd">        the topmost population is preserved&quot; is not the case here.</span>
<span class="sd">        Rather, the first molecule found is preserved.</span>

<span class="sd">        However, this question is only relevant if duplicates in</span>
<span class="sd">        different subpopulations are being removed. In this case it is</span>
<span class="sd">        assumed that it is more important to have a single instance</span>
<span class="sd">        than to worry about which subpopulation it is in.</span>

<span class="sd">        If the duplicates are being removed from within subpopulations,</span>
<span class="sd">        each subpopulation will end up with a single instance of all</span>
<span class="sd">        molecules held before. There is no &quot;choice&quot;.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        between_subpops : :class:`bool`, optional</span>
<span class="sd">            When ``False`` duplicates are only removed from within a</span>
<span class="sd">            given subpopulation. If ``True``, all duplicates are</span>
<span class="sd">            removed, regardless of which subpopulation they are in.</span>

<span class="sd">        key : :class:`callable`, optional</span>
<span class="sd">            Two molecules are considered the same if the values</span>
<span class="sd">            returned by ``key(molecule)`` are the same.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None : :class:`NoneType`</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Whether duplicates are being removed from within a single</span>
        <span class="c1"># subpopulation or from different subpopulations, the duplicate</span>
        <span class="c1"># must be removed from the `members` attribute of some</span>
        <span class="c1"># ``Population`` instance. This means ``dedupe`` can be run</span>
        <span class="c1"># on the `members` attribute of every population or</span>
        <span class="c1"># subpopulation. The only difference is that when duplicates</span>
        <span class="c1"># must be removed between different subpopulations a global</span>
        <span class="c1"># ``seen`` set must be defined for the entire top level</span>
        <span class="c1"># ``Population`` instance. This can be passed each time dedupe</span>
        <span class="c1"># is being called on a subpopulation&#39;s `members` attribute.</span>
        <span class="k">if</span> <span class="n">between_subpops</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">top_seen</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">seen</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">top_seen</span><span class="p">,</span> <span class="nb">set</span><span class="p">):</span>
                <span class="n">seen</span> <span class="o">=</span> <span class="n">top_seen</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">members</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dedupe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">members</span><span class="p">,</span> <span class="n">seen</span><span class="p">,</span> <span class="n">key</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">subpop</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">populations</span><span class="p">:</span>
                <span class="n">subpop</span><span class="o">.</span><span class="n">remove_duplicates</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">seen</span><span class="p">)</span>

        <span class="c1"># If duplicates are only removed from within the same</span>
        <span class="c1"># subpopulation, only the `members` attribute of each</span>
        <span class="c1"># subpopulation needs to be cleared of duplicates. To do this,</span>
        <span class="c1"># each `members` attribute is deduped recursively.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">between_subpops</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">members</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dedupe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">members</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">subpop</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">populations</span><span class="p">:</span>
                <span class="n">subpop</span><span class="o">.</span><span class="n">remove_duplicates</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span></div>

<div class="viewcode-block" id="Population.remove_members"><a class="viewcode-back" href="../../stk_noga.population.html#stk_noga.population.Population.remove_members">[docs]</a>    <span class="k">def</span> <span class="nf">remove_members</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes all members where ``key(member)`` is ``True``.</span>

<span class="sd">        The structure of the population is preserved.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        key : :class:`callable`</span>
<span class="sd">            A callable which takes 1 argument. Each member of the</span>
<span class="sd">            population is passed as the argument to `key` in turn. If</span>
<span class="sd">            the result is ``True`` then the member is removed from the</span>
<span class="sd">            population.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None : :class:`NoneType`</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">members</span> <span class="o">=</span> <span class="p">[</span><span class="n">ind</span> <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">members</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span><span class="p">(</span><span class="n">ind</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">subpop</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">populations</span><span class="p">:</span>
            <span class="n">subpop</span><span class="o">.</span><span class="n">remove_members</span><span class="p">(</span><span class="n">key</span><span class="p">)</span></div>

<div class="viewcode-block" id="Population.to_list"><a class="viewcode-back" href="../../stk_noga.population.html#stk_noga.population.Population.to_list">[docs]</a>    <span class="k">def</span> <span class="nf">to_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts the population to a list representation.</span>

<span class="sd">        The population and any subpopulations are represented as lists</span>
<span class="sd">        (and sublists), while members are represented by their JSON</span>
<span class="sd">        dictionaries (as strings).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        :class:`str`</span>
<span class="sd">            A JSON string representing the population.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">pop</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">json</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">members</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">sp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">populations</span><span class="p">:</span>
            <span class="n">pop</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">to_list</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">pop</span></div>

<div class="viewcode-block" id="Population.write"><a class="viewcode-back" href="../../stk_noga.population.html#stk_noga.population.Population.write">[docs]</a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dir_path</span><span class="p">,</span> <span class="n">use_name</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes the ``.mol`` files of members to a directory.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dir_path : :class:`str`</span>
<span class="sd">            The full path of the directory into which the ``.mol`` file</span>
<span class="sd">            is written.</span>

<span class="sd">        use_name : :class:`bool`, optional</span>
<span class="sd">            When ``True`` the :attr:`.Molecule.name` attribute of the</span>
<span class="sd">            members is used to make the name of the ``.mol`` file. If</span>
<span class="sd">            ``False``, the files are just named after the member&#39;s</span>
<span class="sd">            index in the population.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None : :class:`NoneType`</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># If the directory does not exist, create it.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">dir_path</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">dir_path</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">member</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">use_name</span><span class="p">:</span>
                <span class="n">fname</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">.mol&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                                        <span class="n">member</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fname</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">.mol&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>

            <span class="n">member</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Allows populations to be iterated through,</span>

<span class="sd">        When :class:`Population` instances are iterated through, they</span>
<span class="sd">        yield :class:`.Molecule` instances from the :meth:`all_members`</span>
<span class="sd">        generator.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        :class:`generator`</span>
<span class="sd">            The :meth:`all_members` generator.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_members</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Allows indexing to select members of the population.</span>

<span class="sd">        Molecules held by the :class:`Population` instance can be</span>
<span class="sd">        accessed by their index. Slices are also supported. These return</span>
<span class="sd">        a new :class:`Population` instance holding the members with the</span>
<span class="sd">        requested indices. Using slices will return a flat</span>
<span class="sd">        :class:`Population` instance, meaing no nesting is preserved.</span>

<span class="sd">        The index corresponds to the order of members in</span>
<span class="sd">        :meth:`all_members`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        key : :class:`int`, :class:`slice`</span>
<span class="sd">            An :class:`int` or :class:`slice` can be used depending on</span>
<span class="sd">            if a single members needs to be returned or a cllection of</span>
<span class="sd">            them.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        :class:`.Molecule`</span>
<span class="sd">            If the supplied `key` is an :class:`int`. Returns the</span>
<span class="sd">            :class:`.Molecule` instance with the corresponding index</span>
<span class="sd">            from :meth:`all_members`.</span>

<span class="sd">        :class:`Population`</span>
<span class="sd">            If the supplied `key` is a :class:`slice`. The returned</span>
<span class="sd">            :class:`Population` instance holds members at the given</span>
<span class="sd">            indices in :meth:`all_members`.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        :class:`TypeError`</span>
<span class="sd">            If the supplied `key` is not an :class:`int` or</span>
<span class="sd">            :class:`slice`.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Determine if provided key was an ``int`` or a ``slice``.</span>
        <span class="c1"># If ``int``, return the corresponding ``Molecule``</span>
        <span class="c1"># instance from the `all_members` generator.</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all_members</span><span class="p">())[</span><span class="n">key</span><span class="p">]</span>

        <span class="c1"># If ``slice`` return a ``Population`` of the corresponding</span>
        <span class="c1"># ``Molecule`` instances.</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">slice</span><span class="p">):</span>
            <span class="n">mols</span> <span class="o">=</span> <span class="n">it</span><span class="o">.</span><span class="n">islice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all_members</span><span class="p">(),</span>
                             <span class="n">key</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">key</span><span class="o">.</span><span class="n">stop</span><span class="p">,</span> <span class="n">key</span><span class="o">.</span><span class="n">step</span><span class="p">)</span>
            <span class="n">pop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="o">*</span><span class="n">mols</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">pop</span>

        <span class="c1"># If `key` is not ``int`` or ``slice`` raise ``TypeError``.</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Index must be an integer or slice, not&quot;</span>
                        <span class="s2">&quot; </span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the total number of members in the population.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        :class:`int`</span>
<span class="sd">            The number of members held by the population, including</span>
<span class="sd">            those held within its subpopulations.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all_members</span><span class="p">()))</span>

    <span class="k">def</span> <span class="nf">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes members of `other` from the population.</span>

<span class="sd">        Subtracting one population from another,</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            pop3 = pop1 - pop2</span>

<span class="sd">        returns a new population, ``pop3``. The returned population</span>
<span class="sd">        contains all molecules in ``pop1`` excep those also found in</span>
<span class="sd">        ``pop2``. This refers to all molcules, including those held</span>
<span class="sd">        within any subpopulations. The returned population is flat.</span>
<span class="sd">        This means any nesting in ``pop1`` is not preserved.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        other : :class:`Population`</span>
<span class="sd">            A collection of :class:`.Molecule` instances to be removed</span>
<span class="sd">            from the population, if held by it.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        :class:`Population`</span>
<span class="sd">            A flat population of :class:`.Molecule` instances which</span>
<span class="sd">            are in the population but not in `other`.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">new_pop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">()</span>
        <span class="n">new_pop</span><span class="o">.</span><span class="n">add_members</span><span class="p">(</span><span class="n">mol</span> <span class="k">for</span> <span class="n">mol</span> <span class="ow">in</span> <span class="bp">self</span> <span class="k">if</span> <span class="n">mol</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">other</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new_pop</span>

    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Joins two populations.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        other : :class:`Population`</span>
<span class="sd">            A population to be joined with.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        :class:`Population`</span>
<span class="sd">            A new :class:`Population` instance which holds two</span>
<span class="sd">            subpopulations and no direct members. The two</span>
<span class="sd">            subpopulations are the two :class:`Population` instances on</span>
<span class="sd">            which the ``+`` operator was applied.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="n">item</span> <span class="ow">is</span> <span class="n">mol</span> <span class="k">for</span> <span class="n">mol</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_members</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">output_string</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot; Population &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span>
                         <span class="s2">&quot;--------------------------</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span>
                         <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Members</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;   ---------</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">mol</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">members</span><span class="p">:</span>
            <span class="n">output_string</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">members</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">output_string</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">None</span><span class="se">\n\n</span><span class="s2">&quot;</span>

        <span class="n">output_string</span> <span class="o">+=</span> <span class="p">((</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Sub-populations</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span>
                           <span class="s2">&quot;   -----------------</span><span class="se">\n\t</span><span class="s2">&quot;</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">pop</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">populations</span><span class="p">:</span>
            <span class="n">output_string</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">pop</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">populations</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">output_string</span> <span class="o">+=</span> <span class="s2">&quot;None</span><span class="se">\n\n</span><span class="s2">&quot;</span>

        <span class="n">output_string</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span>

        <span class="k">for</span> <span class="n">pop</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">populations</span><span class="p">:</span>
            <span class="n">output_string</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">pop</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">output_string</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>
</pre></div>

           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Lukas Turcani.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>